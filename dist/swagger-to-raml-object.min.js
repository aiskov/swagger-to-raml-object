!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.swaggerToRamlObject=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var extend=require("extend");var PARAM_TYPE_MAP={string:{type:"string"},number:{type:"number"},integer:{type:"integer"},"boolean":{type:"boolean"},File:{type:"file"},array:{repeat:true}};var JSON_TYPE_MAP={string:{type:"string"},number:{type:"number"},integer:{type:"integer"},"boolean":{type:"boolean"},array:{type:"array"},object:{type:"object"}};var PARAM_FORMAT_MAP={int32:{type:"integer",minimum:-2147483648,maximum:2147483647},int64:{type:"integer",minimum:-0x8000000000000000,maximum:0x8000000000000000},date:{type:"date"},"date-time":{type:"date"}};var URL_ENCODED_MIME="application/x-www-form-urlencoded";var MULTI_PART_MIME="multipart/form-data";var API_SPEC_URI="https://github.com/wordnik/swagger-spec"+"/blob/master/versions/1.2.md#52-api-declaration";module.exports=convertApiDeclaration;function convertApiDeclaration(declaration,ramlObject){ramlObject=ramlObject||{};if(!declaration.basePath||!declaration.apis){throw new Error("Must be a valid api declaration: "+API_SPEC_URI)}if(ramlObject.version&&declaration.apiVersion!==ramlObject.version){throw new Error("The api version has changed: "+ramlObject.version+" -> "+declaration.apiVersion)}else if(!ramlObject.version){ramlObject.version=declaration.apiVersion}addBasePath(declaration.basePath,ramlObject);convertApis(declaration,ramlObject);return ramlObject}function addBasePath(basePath,ramlObject){if(!ramlObject.baseUri){ramlObject.baseUri=basePath;return ramlObject}if(ramlObject.baseUri!==basePath){throw new Error("The base uri has changed: "+ramlObject.baseUri+" -> "+basePath)}return ramlObject}function convertApis(declaration,ramlObject){var relativeUri=declaration.resourcePath;var ramlResources=ramlObject.resources=ramlObject.resources||[];var ramlResource=findResource(ramlResources,relativeUri);declaration.apis.forEach(function(api){var path=api.path;var resource;if(path.substr(0,relativeUri.length)===relativeUri){path=path.substr(relativeUri.length);if(!ramlResource){ramlResource={relativeUri:relativeUri};ramlResources.push(ramlResource)}ramlResource.resources=ramlResource.resources||[];ramlResource.resources.push(resource={relativeUri:path})}else{ramlResources.push(resource={relativeUri:path})}if(api.description){resource.description=api.description}return convertOperations(api.operations,declaration,resource)});return ramlResource}function findResource(resources,uri){var matchingResource;resources.some(function(resource){if(resource.relativeUri===uri){return matchingResource=resource}});return matchingResource}function convertOperations(operations,declaration,ramlResource){ramlResource.methods=ramlResource.methods||[];operations.forEach(function(operation){if(!operation.method){throw new Error("Expected the operation to have a method defined")}var method={method:operation.method,displayName:operation.nickname,description:operation.notes||operation.summary||""};if(operation.deprecated==="true"||operation.deprecated===true){if(method.description){method.description+="\n\n"}method.description+="This method has been deprecated."}convertParameters(operation,declaration,method,ramlResource);convertResponseMessages(operation,declaration,method);ramlResource.methods.push(method)});return ramlResource}function convertResponseMessages(operation,declaration,method){if(!operation.responseMessages||!operation.responseMessages.length){return method}var responses=method.responses=method.responses||{};var produces=operation.produces||declaration.produces||[];operation.responseMessages.forEach(function(response){responses[response.code]={description:response.message};if(produces.length){responses[response.code].body={};produces.forEach(function(mime){responses[response.code].body[mime]=null})}});return method}function convertParameters(operation,declaration,ramlMethod,ramlResource){var consumes=operation.consumes||declaration.consumes||[];var parameters=groupParameters(operation.parameters);if(parameters.path){ramlResource.uriParameters=convertParametersToRaml(parameters.path,declaration)}if(parameters.query){ramlMethod.queryParameters=convertParametersToRaml(parameters.query,declaration)}if(parameters.header){ramlMethod.headers=convertParametersToRaml(parameters.header,declaration)}if(parameters.body){convertBodyParameters(parameters.body,consumes,declaration,ramlMethod)}if(parameters.form){convertFormParameters(parameters.form,consumes,declaration,ramlMethod)}return ramlMethod}var CONVERT_PARAMS_TO_SCHEMA={"application/xml":null,"application/json":convertParameterToJsonSchema};function convertBodyParameters(params,consumes,declaration,ramlMethod){ramlMethod.body=ramlMethod.body||{};params.forEach(function(param){if(param.name!=="body"){throw new Error("Invalid parameter name for body: "+param.name)}consumes.forEach(function(mime){if(CONVERT_PARAMS_TO_SCHEMA[mime]){return ramlMethod.body[mime]={schema:CONVERT_PARAMS_TO_SCHEMA[mime](param,declaration)}}ramlMethod.body[mime]=null})});return ramlMethod}function convertFormParameters(params,consumes,declaration,ramlMethod){var multiPart=consumes.indexOf(MULTI_PART_MIME)>-1;var urlEncoded=consumes.indexOf(URL_ENCODED_MIME)>-1;var ramlParams=convertParametersToRaml(params,declaration);if(!multiPart){multiPart=params.some(function(param){return param.type==="File"})}ramlMethod.body=ramlMethod.body||{};if(multiPart&&urlEncoded){ramlMethod.body[MULTI_PART_MIME]={formParameters:ramlParams};ramlMethod.body[URL_ENCODED_MIME]={formParameters:ramlParams}}else if(multiPart){ramlMethod.body[MULTI_PART_MIME]={formParameters:ramlParams}}else{ramlMethod.body[URL_ENCODED_MIME]={formParameters:ramlParams}}return ramlMethod}function groupParameters(parameters){var groups={};Object.keys(parameters).forEach(function(key){var parameter=parameters[key];var type=parameter.paramType;var group=groups[type]=groups[type]||[];group.push(parameter)});return groups}function convertParametersToRaml(params,declaration){var ramlParams={};params.forEach(function(param){ramlParams[param.name]=convertParameter(param,declaration)});return ramlParams}function convertParameter(param,declaration){var ramlParameter={};if(param.type&&PARAM_TYPE_MAP[param.type]){extend(ramlParameter,PARAM_TYPE_MAP[param.type])}else{}if(PARAM_FORMAT_MAP[param.format]){extend(ramlParameter,PARAM_FORMAT_MAP[param.format])}if(typeof param.description==="string"){ramlParameter.description=param.description}if(typeof param.required==="boolean"){ramlParameter.required=param.required}if(param.defaultValue){ramlParameter.default=param.defaultValue}if(Array.isArray(param.enum)){ramlParameter.enum=param.enum}if(typeof param.minimum==="number"){ramlParameter.minimum=param.minimum}if(typeof param.maximum==="number"){ramlParameter.maximum=param.maximum}return ramlParameter}function convertModelToJson(name,declaration){var schema={};var model=declaration.models[name];Object.keys(declaration.models).some(function(key){var model=declaration.models[key];if(!model||!model.subTypes||!model.subTypes.indexOf(name)){return false}var parentSchema=convertParameterToJson(key,declaration);extend(schema,parentSchema);schema.properties=extend({},parentSchema.properties);return true});Object.keys(model.properties||{}).forEach(function(key){var property=model.properties[key];var properties=schema.properties=schema.properties||{};properties[key]=convertParameterToJson(property,declaration)});return schema}function convertParameterToJson(param,declaration){var schema={};if(param.type&&JSON_TYPE_MAP[param.type]){extend(schema,JSON_TYPE_MAP[param.type])}else{extend(schema,convertModelToJson(param.$ref||param.type,declaration))}["description","defaultValue","enum","minimum","maximum","items","required","uniqueItems"].forEach(function(key){if(param[key]==null){return}if(key==="items"){return schema[key]=convertParameterToJson(param[key],declaration)}schema[key]=param[key]});return schema}function convertParameterToJsonSchema(param,declaration){var schema=extend({$schema:"http://json-schema.org/draft-04/schema#"},convertParameterToJson(param,declaration));return JSON.stringify(schema,null,2)}},{extend:5}],2:[function(require,module,exports){module.exports=parse;function parse(content){return JSON.parse(content)}},{}],3:[function(require,module,exports){var DOCUMENTATION_NAME_MAP={description:"Description",termsOfServiceUrl:"Terms of Service URL",contact:"Contact",license:"License",licenseUrl:"License URL"};var GRANT_TYPE_MAP={implicit:"token",authorization_code:"code"};var API_KEY_PASS_AS_MAP={header:"headers",query:"queryParameters"};var RESOURCE_SPEC_URI="https://github.com/wordnik/swagger-spec"+"/blob/master/versions/1.2.md#51-resource-listing";module.exports=convertResourceListing;function convertResourceListing(resource,ramlObject){if(!resource.apis){throw new Error("Must be a valid resource listing: "+RESOURCE_SPEC_URI)}ramlObject=ramlObject||{};if(resource.apiVersion){ramlObject.version=resource.apiVersion}convertInfo(resource.info,ramlObject);convertAuthorizations(resource.authorizations,ramlObject);return ramlObject}function convertInfo(info,ramlObject){if(!info){return ramlObject}var documentation=Object.keys(DOCUMENTATION_NAME_MAP).filter(function(key){return info[key]}).map(function(key){return{title:DOCUMENTATION_NAME_MAP[key],content:info[key]}});if(info.title){ramlObject.title=info.title}if(documentation.length){ramlObject.documentation=documentation}return ramlObject}function convertAuthorizations(authorizations,ramlObject){if(!authorizations){return ramlObject}ramlObject.securitySchemes=Object.keys(authorizations).map(function(key){var data={};data[key]=convertAuthorization(authorizations[key]);return data});return ramlObject}function convertAuthorization(authorization){if(authorization.type==="oauth2"){return convertOAuth2(authorization)}if(authorization.type==="apiKey"){return convertApiKey(authorization)}if(authorization.type==="basicAuth"){return convertBasicAuth(authorization)}}function convertOAuth2(authorization){var ramlAuth={type:"OAuth 2.0",settings:{authorizationGrants:[]}};var implicit=authorization.grantTypes.implicit;var authCode=authorization.grantTypes.authorization_code;var description=[];var authSettings=ramlAuth.settings;if(authorization.scopes&&authorization.scopes.length){var scopeDescriptions=[];authSettings.scopes=authorization.scopes.map(function(scope){var name=scope.scope;if(scope.description){scopeDescriptions.push("* "+name+" - "+scope.description)}return name});if(scopeDescriptions.length){description.push("Available scopes: ");description.push(scopeDescriptions.join("\n"))}}Object.keys(authorization.grantTypes).forEach(function(grantType){authSettings.authorizationGrants.push(GRANT_TYPE_MAP[grantType])});if(implicit){if(implicit.loginEndpoint&&implicit.loginEndpoint.url){authSettings.authorizationUri=implicit.loginEndpoint.url}if(implicit.tokenName&&implicit.tokenName!=="access_token"){description.push('The token grant uses "'+implicit.tokenName+'" as the token name.')}}if(authCode){var tokenEndpoint=authCode.tokenEndpoint;var tokenRequestEndpoint=authCode.tokenRequestEndpoint;var clientIdName=tokenRequestEndpoint.clientIdName;var clientSecretName=tokenRequestEndpoint.clientSecretName;var tokenName=tokenEndpoint.tokenName;authSettings.accessTokenUri=tokenEndpoint.url;authSettings.authorizationUri=tokenRequestEndpoint.url;if(clientIdName&&clientIdName!=="client_id"){description.push('The code grant uses "'+clientIdName+'" as the parameter for '+"passing the client id.")}if(clientSecretName&&clientSecretName!=="client_secret"){description.push('The code grant uses "'+clientSecretName+'" as the parameter '+"for passing the client secret.")}if(tokenName&&tokenName!=="access_code"){description.push('The code grant uses "'+tokenName+'" as the parameter for '+"passing the authorization token.")}}if(description.length){ramlAuth.description=description.join("\n\n")}return ramlAuth}function convertApiKey(authorization){var ramlAuth={type:"x-api-key",describedBy:{}};var describedBy=API_KEY_PASS_AS_MAP[authorization.passAs];if(describedBy){var description=ramlAuth.describedBy[describedBy]={};description[authorization.keyname]={type:"string",description:"Used to send a valid API key for authentication."}}return ramlAuth}function convertBasicAuth(authorization){return{type:"Basic Authentication"}}},{}],4:[function(require,module,exports){module.exports=isResourceListing;function isResourceListing(resource){return!resource.basePath}},{}],5:[function(require,module,exports){var hasOwn=Object.prototype.hasOwnProperty;var toString=Object.prototype.toString;var undefined;var isPlainObject=function isPlainObject(obj){"use strict";if(!obj||toString.call(obj)!=="[object Object]"||obj.nodeType||obj.setInterval){return false}var has_own_constructor=hasOwn.call(obj,"constructor");var has_is_property_of_method=obj.constructor&&obj.constructor.prototype&&hasOwn.call(obj.constructor.prototype,"isPrototypeOf");if(obj.constructor&&!has_own_constructor&&!has_is_property_of_method){return false}var key;for(key in obj){}return key===undefined||hasOwn.call(obj,key)};module.exports=function extend(){"use strict";var options,name,src,copy,copyIsArray,clone,target=arguments[0],i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}else if(typeof target!=="object"&&typeof target!=="function"||target==undefined){target={}}for(;i<length;++i){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(isPlainObject(copy)||(copyIsArray=Array.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&Array.isArray(src)?src:[]}else{clone=src&&isPlainObject(src)?src:{}}target[name]=extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target}},{}],6:[function(require,module,exports){var parse=require("./lib/parse");var isResourceListing=require("./lib/utils/is-resource-listing");var convertApiDeclaration=require("./lib/api-declaration");var convertResourceListing=require("./lib/resource-listing");module.exports=swaggerToRamlObject;function swaggerToRamlObject(filename,filereader,done){var read=wrapFileReader(filereader);return read(filename,wrapContents(function(result){if(!isResourceListing(result)){return done(null,convertApiDeclaration(result))}var ramlObject=convertResourceListing(result);var resources=result.apis.map(function(api){return filename+api.path});return async(resources,read,wrapContents(function(results){results.forEach(function(result){convertApiDeclaration(result,ramlObject)});return done(null,ramlObject)},done))},done))}function async(items,fn,done){var count=0;var length=items.length;var results=[];var errored=false;items.forEach(function(item,index){fn(item,function(err,result){if(errored){return}if(err){return done(err)}count++;results[index]=result;if(count===length){return done(null,results)}})})}function wrapFileReader(fn){return function(filename,done){return fn(filename,function(err,result){if(err){return done(err)}try{return done(null,parse(result))}catch(e){return done(e)}})}}function wrapContents(resolve,reject){return function(err,result){if(err){return reject(err)}try{return resolve(result)}catch(e){return reject(e)}}}},{"./lib/api-declaration":1,"./lib/parse":2,"./lib/resource-listing":3,"./lib/utils/is-resource-listing":4}]},{},[6])(6)});